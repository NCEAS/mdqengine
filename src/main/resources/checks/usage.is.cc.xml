<?xml version="1.0" encoding="UTF-8"?>
<mdq:check xmlns:mdq="https://nceas.ucsb.edu/mdqe" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="https://nceas.ucsb.edu/mdqe ../schemas/schema1.xsd">
  <id>check.usage.is.cc.1</id>
  <name>Usage</name>
  <description>Usage should be Creative Commons</description>
  <type>identification</type>
  <level>REQUIRED</level>
  <environment>rscript</environment>
  <code><![CDATA[
library(stringr)

phrases <- c("This work is licensed under the Creative Commons Attribution 4.0 International License.\nTo view a copy of this license, visit http://creativecommons.org/licenses/by/4.0/.",
             "This work is dedicated to the public domain under the Creative Commons Universal 1.0 Public Domain Dedication.\nTo view a copy of this dedication, visit https://creativecommons.org/publicdomain/zero/1.0/.")

if (length(rights) == 0) {
  status <- "FAILURE"
  message <- "The document is not explicitly licensed with a Creative Commons CC-0 or CC-BY license."
} else if (length(rights) > 1) {
  status <- "FAILURE"
  message <- "More than one license was found which was an unexpected state."
} else {
  if (any(str_detect(rights[[1]], phrases))) {
    status <- "SUCCESS"
    message <- "The document is explicitly licensed with a Creative Commons CC-0 or CC-BY license."
  } else {
    status <- "FAILURE"
    message <- "The document is not explicitly licensed with a Creative Commons CC-0 or CC-BY license."
  }
}

mdq_result <- list(status = status,
                   output = list(list(value = message)))
  ]]></code>
  <selector>
    <name>rights</name>
    <xpath>/eml/dataset/intellectualRights/para</xpath>
  </selector>
  <dialect>
    <name>eml</name>
    <xpath>boolean(/*[local-name() = 'eml'])</xpath>
  </dialect>
</mdq:check>
