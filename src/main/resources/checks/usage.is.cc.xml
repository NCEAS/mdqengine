<?xml version="1.0" encoding="UTF-8"?>
<mdq:check xmlns:mdq="https://nceas.ucsb.edu/mdqe" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="https://nceas.ucsb.edu/mdqe ../schemas/schema1.xsd">
  <id>check.usage.is.cc.1</id>
  <name>Usage</name>
  <description>Usage should be Creative Commons</description>
  <type>identification</type>
  <level>REQUIRED</level>
  <environment>rscript</environment>
  <code><![CDATA[
library(stringr)
phrases <- c("This work is licensed under the Creative Commons Attribution 4.0 International License.",
             "To view a copy of this license, visit http://creativecommons.org/licenses/by/4.0/.")

if (length(rights) == 0) {
  status <- "FAILURE"
  message <- "The appropriate license was not found."
} else if (length(rights) > 1) {
  status <- "FAILURE"
  message <- "More than one license was found which was an unexpected state."
} else {
  if (str_detect(rights[[1]], phrases[1]) && str_detect(rights[[1]], phrases[1])) {
    status <- "SUCCESS"
    message <- "The proper license wording was found."
  } else {
    status <- "FAILURE"
    message <- "The proper license wording was not found."
  }
}

mdq_result <- list(status = status,
                   output = list(list(value = message)))
  ]]></code>
  <selector>
    <name>rights</name>
    <xpath>/eml/dataset/intellectualRights/para</xpath>
  </selector>
  <dialect>
    <name>eml</name>
    <xpath>boolean(/*[local-name() = 'eml'])</xpath>
  </dialect>
</mdq:check>
