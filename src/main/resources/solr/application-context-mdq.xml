<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<bean id="mdqSubprocessor" class="org.dataone.cn.indexer.parser.ScienceMetadataDocumentSubprocessor">

		<!-- match MDQ documents -->
		<property name="matchDocuments">
			<list>
				<value>https://nceas.ucsb.edu/mdqe/v1</value>
			</list>
		</property>
		<property name="fieldList">
			<list>
				<ref bean="mdq.runId"/>
				<ref bean="mdq.suiteId"/>
				<ref bean="mdq.timestamp"/>
				<ref bean="mdq.metadata.formatId"/>
				<ref bean="mdq.metadata.datasource"/>
				<ref bean="mdq.metadata.funder"/>
				<ref bean="mdq.metadata.funder.lookup"/>
				<ref bean="mdq.metadata.rightsHolder"/>
				<ref bean="mdq.metadata.group"/>
				<ref bean="mdq.checks.passed"/>
				<ref bean="mdq.checks.warned"/>
				<ref bean="mdq.checks.failed"/>
				<ref bean="mdq.checks.info"/>
				<ref bean="mdq.check.count"/>
				<ref bean="mdq.score.overall"/>
			</list>
		</property>
	</bean>

	<bean id="mdq.runId" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="runId"/>
		<constructor-arg name="xpath"
						 value="/*[local-name() = 'run']/id"/>
		<property name="multivalue" value="false"/>
	</bean>

	<bean id="mdq.suiteId" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="suiteId"/>
		<constructor-arg name="xpath"
						 value="//suiteId"/>
		<property name="multivalue" value="false"/>
	</bean>

	<bean id="mdq.timestamp" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="timestamp"/>
		<constructor-arg name="xpath"
						 value="//timestamp"/>
		<property name="multivalue" value="false"/>
		<property name="converter" ref="dateConverter"/>
	</bean>

	<bean id="mdq.metadata.formatId" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="metadataFormatId"/>
		<constructor-arg name="xpath"
						 value="//result[check/id[text() = 'check.echo.formatId.1']]/output/text()"/>
		<property name="multivalue" value="false"/>
	</bean>

	<bean id="mdq.metadata.datasource" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="metadataDatasource"/>
		<constructor-arg name="xpath"
						 value="//result[check/id[text() = 'check.echo.datasource.1']]/output/text()"/>
		<property name="multivalue" value="false"/>
	</bean>

	<bean id="mdq.metadata.funder" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="metadataFunder"/>
		<constructor-arg name="xpath"
						 value="//result[check/id[text() = 'check.echo.funder.1']]/output/text()"/>
		<property name="multivalue" value="true"/>
		<property name="dedupe" value="true"/>
	</bean>

	<bean id="mdq.metadata.funder.lookup" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="metadataFunderLookup"/>
		<constructor-arg name="xpath"
						 value="//result[check/id[text() = 'check.lookup.funder.1']]/output/text()"/>
		<property name="multivalue" value="true"/>
		<property name="dedupe" value="true"/>
	</bean>

	<bean id="mdq.metadata.rightsHolder" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="metadataRightsHolder"/>
		<constructor-arg name="xpath"
						 value="//result[check/id[text() = 'check.echo.rightsHolder.1']]/output/text()"/>
		<property name="multivalue" value="false"/>
	</bean>

	<bean id="mdq.metadata.group" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="metadataGroup"/>
		<constructor-arg name="xpath"
						 value="//result[check/id[text() = 'check.lookup.group.1']]/output/text()"/>
		<property name="multivalue" value="true"/>
		<property name="dedupe" value="true"/>
	</bean>

	<!-- scoring by result status -->
	<bean id="mdq.checks.passed" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="checksPassed"/>
		<constructor-arg name="xpath"
						 value="count(//result[check/level[text() != 'INFO']]/status[text() = 'SUCCESS'])"/>
		<property name="multivalue" value="false"/>
	</bean>
	<bean id="mdq.checks.warned" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="checksWarned"/>
		<constructor-arg name="xpath"
						 value="count( //result[check/level[text() != 'INFO']]/status[text() = 'ERROR'] | //result[check/level[text() = 'OPTIONAL']]/status[text() = 'FAILURE'])"/>
		<property name="multivalue" value="false"/>
	</bean>
	<bean id="mdq.checks.failed" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="checksFailed"/>
		<constructor-arg name="xpath"
						 value="count(//result[check/level[text() = 'REQUIRED']]/status[text() = 'FAILURE'])"/>
		<property name="multivalue" value="false"/>
	</bean>

	<bean id="mdq.checks.info" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="checksInfo"/>
		<constructor-arg name="xpath"
						 value="count(//result/status[text() = 'SKIP'] | //result[check/level[text() = 'INFO']])"/>
		<property name="multivalue" value="false"/>
    </bean>

	<bean id="mdq.check.count" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="checkCount"/>
		<constructor-arg name="xpath"
						 value="count(//result)"/>
		<property name="multivalue" value="false"/>
	</bean>

	<!-- the composite score -->
	<bean id="mdq.score.overall" class="org.dataone.cn.indexer.parser.SolrField">
		<constructor-arg name="name" value="scoreOverall"/>
		<constructor-arg name="xpath"
						 value="count(//result[check/level[text() != 'INFO']]/status[text() = 'SUCCESS']) div (count(//result) - count(//result/status[text() = 'SKIP'] | //result[check/level[text() = 'INFO']]))"/>
		<property name="multivalue" value="false"/>
	</bean>

	<bean id="mdqAddDynamicFieldsSubprocessor" class="edu.ucsb.nceas.mdqengine.solr.QualityReportSubprocessor">
	    <property name="matchDocuments">
		    <list>
			    <value>https://nceas.ucsb.edu/mdqe/v1</value>
		    </list>
	</property>
	</bean>
</beans>
